<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Recherche Training: Signalementsbeheer</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root { --polblauw: #1d4e89; --grijs: #334155; --bg: #f8fafc; --border: #cbd5e1; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); margin: 0; padding: 20px; color: var(--grijs); }
        .container { max-width: 1100px; margin: auto; background: white; padding: 30px; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); border-top: 5px solid var(--polblauw); }
        
        /* Visuele componenten */
        .foto-groot { 
            position: relative; width: 100%; height: 600px; 
            background-image: url('Q2PVaangifte%20les%204plaatsdelict.png'); 
            background-size: cover; background-position: center; border: 1px solid var(--polblauw); 
        }
        .foto-zoom { 
            width: 250px; height: 350px; margin: 15px auto; border: 2px solid var(--polblauw);
            background-image: url('Q2PVaangifte%20les%204plaatsdelict.png'); background-repeat: no-repeat;
        }
        
        .vakje { position: absolute; cursor: pointer; border: 1px solid transparent; z-index: 10; }
        .vakje:hover { border-color: white; background: rgba(255, 255, 255, 0.2); }

        /* Navigatie en Structuur */
        .scherm { display: none; }
        .actief { display: block; }
        .nav-tabs { display: flex; gap: 2px; margin-bottom: 25px; background: #e2e8f0; padding: 5px; border-radius: 4px; }
        .nav-btn { flex: 1; padding: 12px; cursor: pointer; border: none; background: transparent; font-size: 14px; font-weight: 600; text-transform: uppercase; color: var(--grijs); }
        .nav-btn.active { background: white; color: var(--polblauw); box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        
        .instructie-veld { background: #f1f5f9; padding: 20px; border-radius: 4px; border-left: 4px solid var(--polblauw); margin-bottom: 20px; line-height: 1.6; }
        .timer-veld { font-family: monospace; font-size: 20px; font-weight: bold; color: var(--polblauw); text-align: right; margin-bottom: 10px; }
        
        input, textarea { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid var(--border); border-radius: 4px; box-sizing: border-box; font-family: inherit; }
        button.action-btn { padding: 12px 24px; cursor: pointer; background: var(--polblauw); color: white; border: none; border-radius: 4px; font-weight: bold; width: 100%; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 25px; font-size: 14px; }
        th, td { border: 1px solid var(--border); padding: 12px; text-align: left; }
        th { background: #f8fafc; text-transform: uppercase; letter-spacing: 0.05em; }
    </style>
</head>
<body>

<div class="container">
    <div id="login-sectie" style="text-align:center; padding: 40px 0;">
        <h3 style="margin-top:0;">Autorisatie Vereist</h3>
        <p>Voer uw achternaam en voorletters in voor toegang tot het systeem.</p>
        <input type="text" id="speler-naam" placeholder="Naam Verbalisant" style="max-width:300px; text-align:center;">
        <br>
        <button onclick="inloggen()" class="action-btn" style="max-width:300px;">Systeem Toegang</button>
    </div>

    <div id="hoofd-menu" style="display:none;">
        <div class="nav-tabs">
            <button id="btn-d1" class="nav-btn active" onclick="switchDeel(1)">Fase 1: Herkenningstraining</button>
            <button id="btn-d2" class="nav-btn" onclick="switchDeel(2)">Fase 2: Dossieropbouw</button>
        </div>

        <div id="scherm-deel1" class="scherm actief">
            <div id="d1-start">
                <div class="instructie-veld">
                    <strong>Protocol Fase 1:</strong> Er wordt een extern signalement gegenereerd. Identificeer de betreffende persoon op de plaats delict binnen een zo kort mogelijke tijd.
                </div>
                <button onclick="startDeel1()" class="action-btn">Start Identificatieprocedure</button>
            </div>
            <div id="d1-spel" style="display:none;">
                <div class="timer-veld" id="d1-timer">0.00s</div>
                <div class="instructie-veld" id="d1-opdracht"></div>
                <div class="foto-groot" id="pd-foto-d1"></div>
            </div>
        </div>

        <div id="scherm-deel2" class="scherm">
            <div class="instructie-veld">
                <strong>Protocol Fase 2:</strong> Stel een signalement op van de geselecteerde persoon. Gebruik de vastgestelde indeling: Vaste kenmerken (fysiek) en Veranderlijke kenmerken (kleding/accessoires).
            </div>
            <div id="zoom-box" class="foto-zoom"></div>
            <textarea id="d2-tekst" placeholder="Vaste kenmerken: ...
Veranderlijke kenmerken: ..."></textarea>
            <button onclick="opslaanDeel2()" class="action-btn">Verstuur naar Live Dossier</button>
            
            <table id="dossier-tabel">
                <thead>
                    <tr><th>Verbalisant</th><th>Signalement</th><th>Validatie</th></tr>
                </thead>
                <tbody id="dossier-lijst"></tbody>
            </table>
        </div>

        <div id="scherm-check-collega" class="scherm">
            <button onclick="switchDeel(2)" style="background:#64748b; margin-bottom:10px;" class="action-btn">Terug naar Dossieroverzicht</button>
            <div class="instructie-veld">
                <strong>Validatie Signalement van: <span id="collega-naam"></span></strong><br>
                <div id="collega-tekst" style="margin-top:10px; font-style: italic;"></div>
            </div>
            <div class="foto-groot" id="pd-foto-check"></div>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBOo2LzR1IBnsiBR2SCwPJABtaRv0tpKQ4",
        authDomain: "speeltuin-recherche.firebaseapp.com",
        databaseURL: "https://speeltuin-recherche-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "speeltuin-recherche",
        storageBucket: "speeltuin-recherche.firebasestorage.app",
        messagingSenderId: "499912834123",
        appId: "1:499912834123:web:3c84cbf4d5eb13131961ce"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let spelerNaam = "";
    let d1StartTime, d1Interval, d1CorrectId;
    let d2TargetIndex = 0;

    const personen = [
        {id: 0, x: 7, y: 38, w: 9, h: 42, zPos: "8% 45%", zSize: "1000%", vast: "Man; ca. 1.85m; atletisch; donker haar; donkere ogen.", veranderlijk: "Oranje hoodie; baggy model; spijkerbroek."},
        {id: 1, x: 62, y: 36, w: 9, h: 44, zPos: "65% 42%", zSize: "900%", vast: "Vrouw; ca. 1.70m; slank; rood lang haar; lichte ogen.", veranderlijk: "Wit overhemd; zwart lederlook jack; handtas."},
        {id: 2, x: 84, y: 32, w: 10, h: 58, zPos: "93% 45%", zSize: "800%", vast: "Man; ca. 1.90m; fors; grijs kort haar.", veranderlijk: "Grijs kostuum (wol); zakelijke snit; telefoon gebruik."},
        {id: 3, x: 31, y: 39, w: 8, h: 41, zPos: "34% 45%", zSize: "1000%", vast: "Man; ca. 1.75m; gemiddeld postuur; bruin haar.", veranderlijk: "Donkere jas; camera om de hals."},
        {id: 7, x: 30, y: 56, w: 18, h: 40, zPos: "38% 75%", zSize: "700%", vast: "Onbekend; ca. 1.80m; postuur verborgen.", veranderlijk: "Wit Tyvek-pak; blauwe latex handschoenen; werkhouding."}
    ];

    function inloggen() {
        spelerNaam = document.getElementById('speler-naam').value.trim();
        if(!spelerNaam) return;
        document.getElementById('login-sectie').style.display = "none";
        document.getElementById('hoofd-menu').style.display = "block";
        prepDeel2();
    }

    function switchDeel(nr) {
        document.querySelectorAll('.scherm').forEach(s => s.style.display = "none");
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        if(nr === 1) { document.getElementById('scherm-deel1').style.display = "block"; document.getElementById('btn-d1').classList.add('active'); clearInterval(d1Interval); }
        if(nr === 2) { document.getElementById('scherm-deel2').style.display = "block"; document.getElementById('btn-d2').classList.add('active'); }
    }

    function startDeel1() {
        document.getElementById('d1-start').style.display = "none";
        document.getElementById('d1-spel').style.display = "block";
        const p = personen[Math.floor(Math.random() * personen.length)];
        d1CorrectId = p.id;
        document.getElementById('d1-opdracht').innerHTML = `<strong>Vaste kenmerken:</strong> ${p.vast}<br><strong>Veranderlijke kenmerken:</strong> ${p.veranderlijk}`;
        tekenGebieden('pd-foto-d1', (id) => {
            if(id === d1CorrectId) {
                clearInterval(d1Interval);
                alert("Identificatie voltooid. Tijd: " + document.getElementById('d1-timer').innerText);
                document.getElementById('d1-start').style.display = "block";
                document.getElementById('d1-spel').style.display = "none";
            }
        });
        d1StartTime = Date.now();
        d1Interval = setInterval(() => {
            document.getElementById('d1-timer').innerText = ((Date.now() - d1StartTime)/1000).toFixed(2) + "s";
        }, 50);
    }

    function prepDeel2() {
        d2TargetIndex = Math.floor(Math.random() * personen.length);
        const zb = document.getElementById('zoom-box');
        zb.style.backgroundPosition = personen[d2TargetIndex].zPos;
        zb.style.backgroundSize = personen[d2TargetIndex].zSize;
    }

    function opslaanDeel2() {
        const txt = document.getElementById('d2-tekst').value;
        if(txt.length < 10) return;
        db.ref('les/studenten/' + spelerNaam).set({ tekst: txt, doel: d2TargetIndex });
        alert("Signalement geregistreerd.");
    }

    function bekijkCollega(naam, tekst, doel) {
        document.querySelectorAll('.scherm').forEach(s => s.style.display = "none");
        document.getElementById('scherm-check-collega').style.display = "block";
        document.getElementById('collega-naam').innerText = naam;
        document.getElementById('collega-tekst').innerText = tekst;
        tekenGebieden('pd-foto-check', (id) => {
            if(id === personen[doel].id) { alert("Validatie succesvol."); switchDeel(2); }
            else { alert("Identificatie onjuist."); }
        });
    }

    function tekenGebieden(cid, cb) {
        const pd = document.getElementById(cid);
        pd.innerHTML = "";
        personen.forEach(p => {
            const v = document.createElement('div');
            v.className = "vakje";
            v.style.left = p.x + "%"; v.style.top = p.y + "%";
            v.style.width = p.w + "%"; v.style.height = p.h + "%";
            v.onclick = () => cb(p.id);
            pd.appendChild(v);
        });
    }

    db.ref('les/studenten').on('value', snap => {
        const lijst = document.getElementById('dossier-lijst');
        lijst.innerHTML = "";
        snap.forEach(s => {
            const d = s.val();
            lijst.innerHTML += `<tr><td>${s.key}</td><td>${d.tekst}</td><td><button onclick="bekijkCollega('${s.key}', '${d.tekst}', ${d.doel})">Valideer</button></td></tr>`;
        });
    });
</script>
</body>
</html>
